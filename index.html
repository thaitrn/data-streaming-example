<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Streaming DOB App</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <style>
        html, body {
            font-family: 'Poppins', Arial, sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f0fdfa 100%);
            min-height: 100vh;
        }
        h1, h2, h3 {
            font-family: 'Poppins', Arial, sans-serif;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.25rem; }
        .markdown-content p, .markdown-content li {
            font-size: 1.08rem;
            line-height: 1.7;
        }
        .max-w-4xl {
            background: rgba(255,255,255,0.7);
            border-radius: 2rem;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.12);
        }
        .rounded-xl, .rounded-2xl {
            border-radius: 1.25rem !important;
        }
        .shadow-xl, .shadow {
            box-shadow: 0 4px 24px 0 rgba(31, 38, 135, 0.10) !important;
        }
        .card {
            transition: box-shadow 0.3s, transform 0.3s;
            border: 1.5px solid #e5e7eb;
            background: #fff;
        }
        .card:hover {
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
            transform: translateY(-2px) scale(1.01);
        }
        .card h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .card .icon {
            width: 1.3em;
            height: 1.3em;
            vertical-align: middle;
        }
        .modern-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: 2rem;
            font-weight: 600;
            box-shadow: 0 2px 8px 0 rgba(59,130,246,0.08);
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .modern-btn svg {
            width: 1.2em;
            height: 1.2em;
        }
        .modern-btn:hover {
            background: #3b82f6;
            color: #fff;
            box-shadow: 0 4px 16px 0 rgba(59,130,246,0.15);
        }
        #progress-bar-container {
            margin-bottom: 1.5rem;
        }
        #progress-bar {
            background: linear-gradient(90deg, #60a5fa 0%, #818cf8 100%);
            animation: progress-stripes 1s linear infinite;
        }
        @keyframes progress-stripes {
            0% { background-position: 0 0; }
            100% { background-position: 40px 0; }
        }
        /* Card reveal animation */
        .card, .rounded-xl, .rounded-b-xl {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s, transform 0.5s;
        }
        .card.show, .rounded-xl.show, .rounded-b-xl.show {
            opacity: 1;
            transform: translateY(0);
        }
        /* Responsive tweaks */
        @media (max-width: 640px) {
            h1 { font-size: 2rem; }
            h2 { font-size: 1.3rem; }
            .max-w-4xl { padding: 0.5rem; }
            .grid-cols-1, .md\:grid-cols-2 { grid-template-columns: 1fr !important; }
        }
        /* AI typing dots animation */
        #ai-dots .dot {
            animation: blink 1.2s infinite both;
            font-size: 1.5em;
        }
        #ai-dots .dot:nth-child(2) { animation-delay: 0.2s; }
        #ai-dots .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink {
            0%, 80%, 100% { opacity: 0; }
            40% { opacity: 1; }
        }
        /* Pulse effect for highlight button */
        .pulse-highlight {
            box-shadow: 0 0 0 0 rgba(34,197,94,0.7);
            animation: pulse-green 1.5s infinite;
            border: 2.5px solid #22c55e;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34,197,94,0.7); }
            70% { box-shadow: 0 0 0 12px rgba(34,197,94,0.0); }
            100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.0); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-4">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <h1 id="title" class="text-4xl font-extrabold mb-6 text-center tracking-tight">AI DOB Insights</h1>
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-10">
            <div class="mb-6 input-icon">
                <label for="dob" id="dob-label" class="block text-gray-700 font-semibold mb-2 text-lg">Enter Your Birth Date:</label>
                <input type="date" id="dob" class="w-full p-2 border rounded pl-10 text-lg" required pattern="\\d{4}-\\d{2}-\\d{2}" inputmode="none" onkeydown="return false;">
                <div id="dob-error" class="input-error" style="display:none;"></div>
            </div>
            <button id="submit" class="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 text-lg font-semibold transition">Get My Insights</button>
            <div id="spinner" style="display:none;" class="flex justify-center mt-4">
                <div class="animate-spin rounded-full h-8 w-8 border-t-4 border-b-4 border-blue-500"></div>
            </div>
        </div>

        <div id="result" class="bg-white rounded-2xl shadow-xl p-8 mb-10 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Your Personal Insights</h2>
                <div id="ai-status" class="flex items-center gap-2 text-blue-500 text-lg font-semibold">
                    <span id="ai-status-text">AI ƒëang ph√¢n t√≠ch...</span>
                    <span id="ai-dots" class="inline-block"><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></span>
                </div>
            </div>
            <div id="insight-hint" class="text-center text-gray-600 mb-6">B·∫°n c√≥ mu·ªën xem th√™m v·ªÅ Your Personality Traits, Life Cycle Analysis, Interesting Facts?</div>
            <div id="card-buttons" class="flex flex-col md:flex-row gap-4 justify-center mb-6 hidden">
                <button id="btn-personality" class="modern-btn bg-teal-100 text-teal-700 font-semibold py-2 px-4" onclick="manualOpenCard('personality-traits-card')"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg> Xem Personality Traits</button>
                <button id="btn-life-cycle" class="modern-btn bg-yellow-100 text-yellow-700 font-semibold py-2 px-4" onclick="manualOpenCard('life-cycle-card')"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0-6C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg> Xem Life Cycle Analysis</button>
                <button id="btn-interesting" class="modern-btn bg-pink-100 text-pink-700 font-semibold py-2 px-4" onclick="manualOpenCard('interesting-facts-card')"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01"/></svg> Xem Interesting Facts</button>
            </div>
            <div id="progress-bar-container" class="w-full flex justify-center mb-6 hidden">
                <div class="w-2/3 bg-gray-200 rounded-full h-3 overflow-hidden">
                    <div id="progress-bar" class="bg-blue-400 h-3 rounded-full transition-all duration-300" style="width:0%"></div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Basic Info (always visible after submit) -->
                <div>
                    <div id="basic-info-card" class="bg-indigo-50 p-6 rounded-xl shadow card">
                        <h3 class="text-lg font-bold mb-2 text-indigo-700"><span class="icon">üìã</span>Basic Information</h3>
                        <div class="markdown-content" id="basic-info"></div>
                    </div>
                </div>
                <!-- Personal Traits -->
                <div>
                    <div id="personality-traits-card" class="bg-teal-50 p-6 rounded-b-xl shadow card hidden">
                        <h3 class="text-lg font-bold mb-2 text-teal-700"><span class="icon">üß†</span>Your Personality Traits</h3>
                        <div class="markdown-content" id="personality-traits"></div>
                    </div>
                </div>
                <!-- Life Cycle -->
                <div>
                    <div id="life-cycle-card" class="bg-yellow-50 p-6 rounded-b-xl shadow card hidden">
                        <h3 class="text-lg font-bold mb-2 text-yellow-700"><span class="icon">üå±</span>Life Cycle Analysis</h3>
                        <div class="markdown-content" id="life-cycle"></div>
                    </div>
                </div>
                <!-- Interesting Facts -->
                <div>
                    <div id="interesting-facts-card" class="bg-pink-50 p-6 rounded-b-xl shadow card hidden">
                        <h3 class="text-lg font-bold mb-2 text-pink-700"><span class="icon">‚ú®</span>Interesting Facts</h3>
                        <div class="markdown-content" id="interesting-facts"></div>
                    </div>
                </div>
                <!-- Shopping Suggestions -->
                <div>
                    <button id="btn-shopping" class="modern-btn bg-green-100 text-green-700 font-semibold py-2 px-4 pulse-highlight" onclick="manualOpenShoppingCard()"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 6h15l-1.5 9h-13z"/><circle cx="9" cy="21" r="1"/><circle cx="19" cy="21" r="1"/></svg>G·ª£i √Ω v·∫≠t ph·∫©m phong thu·ª∑</button>
                    <div id="shopping-suggestions-card" class="bg-green-50 p-6 rounded-b-xl shadow card hidden">
                        <h3 class="text-lg font-bold mb-2 text-green-700"><span class="icon">üõçÔ∏è</span>G·ª£i √Ω v·∫≠t ph·∫©m phong thu·ª∑</h3>
                        <div class="markdown-content" id="shopping-suggestions"></div>
                    </div>
                </div>
            </div>
            <button id="try-another" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 font-semibold transition">Try Another Date</button>
        </div>
    </div>

    <script>
        // Language support
        const LANGS = {
            vi: {
                title: 'Ph√¢n t√≠ch ng√†y sinh AI',
                dobLabel: 'Nh·∫≠p ng√†y sinh',
                process: 'X·ª≠ l√Ω',
                processing: 'ƒêang x·ª≠ l√Ω...',
                error: 'L·ªói k·∫øt n·ªëi m√°y ch·ªß.',
                invalid: 'Vui l√≤ng nh·∫≠p ng√†y sinh h·ª£p l·ªá.',
                placeholder: 'Nh·∫≠p ng√†y sinh c·ªßa b·∫°n ƒë·ªÉ nh·∫≠n ph√¢n t√≠ch t·ª´ AI'
            },
            en: {
                title: 'AI Date of Birth Processor',
                dobLabel: 'Enter Date of Birth',
                process: 'Process',
                processing: 'Processing...',
                error: 'Error connecting to server.',
                invalid: 'Please enter a valid date of birth.',
                placeholder: 'Enter your date of birth to get AI analysis'
            }
        };
        
        let currentLang = 'vi';
        let isProcessing = false;
        
        const setLang = (lang) => {
            currentLang = lang;
            document.getElementById('title').textContent = LANGS[lang].title;
            document.getElementById('dob-label').textContent = LANGS[lang].dobLabel;
            document.getElementById('submit').textContent = isProcessing ? LANGS[lang].processing : LANGS[lang].process;
            // document.getElementById('lang-vi').className = lang === 'vi' ? 
            //     'px-3 py-1 mr-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors' : 
            //     'px-3 py-1 mr-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors';
            // document.getElementById('lang-en').className = lang === 'en' ? 
            //     'px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors' : 
            //     'px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors';
            
            // Update placeholder if it's visible
            const placeholder = document.getElementById('placeholder');
            if (placeholder && placeholder.style.display !== 'none') {
                placeholder.querySelector('p').textContent = LANGS[lang].placeholder;
            }
        };
        
        // document.getElementById('lang-vi').onclick = () => setLang('vi');
        // document.getElementById('lang-en').onclick = () => setLang('en');
        setLang(currentLang);

        // Function to convert markdown to HTML
        function markdownToHtml(markdown) {
            // Configure marked options
            marked.setOptions({
                breaks: true,
                gfm: true
            });
            
            return marked.parse(markdown);
        }

        // Function to add emoji icons for better visual appeal
        function enhanceContent(html) {
            return html
                .replace(/<strong>(Tu·ªïi|Age):<\/strong>/g, '‚è≥ <strong>$1:</strong>')
                .replace(/<strong>(Cung ho√†ng ƒë·∫°o|Zodiac Sign):<\/strong>/g, '‚≠ê <strong>$1:</strong>')
                .replace(/<strong>(Nh·∫≠n x√©t t√≠nh c√°ch|Personality Insight):<\/strong>/g, 'üòä <strong>$1:</strong>')
                .replace(/<strong>(Ng√†y sinh|Date of Birth):<\/strong>/g, 'üìÖ <strong>$1:</strong>')
                .replace(/<strong>(Ph√¢n t√≠ch|Analysis):<\/strong>/g, 'üîç <strong>$1:</strong>')
                .replace(/<strong>(T√≠nh c√°ch|Personality):<\/strong>/g, 'üé≠ <strong>$1:</strong>');
        }

        // Th√™m bi·∫øn ƒë·ªÉ qu·∫£n l√Ω auto open
        let autoOpenTimeouts = [];
        let autoOpenStopped = false;

        // H√†m m·ªü card th·ªß c√¥ng v√† d·ª´ng auto open
        function manualOpenCard(cardId) {
            autoOpenStopped = true;
            clearAutoOpenTimeouts();
            document.getElementById('ai-status').style.display = 'none';
            const card = document.getElementById(cardId);
            card.classList.remove('hidden');
            setTimeout(() => card.classList.add('show'), 10);
        }
        function clearAutoOpenTimeouts() {
            autoOpenTimeouts.forEach(t => clearTimeout(t));
            autoOpenTimeouts = [];
        }

        // G·ª£i √Ω v·∫≠t ph·∫©m phong thu·ª∑ ch·ªâ render khi user click
        function manualOpenShoppingCard() {
            autoOpenStopped = true;
            clearAutoOpenTimeouts();
            const card = document.getElementById('shopping-suggestions-card');
            card.classList.remove('hidden');
            setTimeout(() => card.classList.add('show'), 10);
            // Sinh n·ªôi dung khi click
            const zodiac = window.lastZodiac;
            const age = window.lastAge;
            const shoppingSuggestionsMap = {
                'Aries': ['ƒê√° ruby', 'V·∫≠t ph·∫©m m√†u ƒë·ªè', 'ƒê·ªìng h·ªì th·ªÉ thao'],
                'Taurus': ['ƒê√° th·∫°ch anh h·ªìng', 'C√¢y xanh nh·ªè', 'ƒê·ªì trang tr√≠ g·ªëm'],
                'Gemini': ['S√°ch', 'B√∫t k√Ω', 'Ph·ª• ki·ªán ƒëa nƒÉng'],
                'Cancer': ['ƒê√° m·∫∑t trƒÉng', 'Khung ·∫£nh gia ƒë√¨nh', 'N·∫øn th∆°m'],
                'Leo': ['ƒê√° m·∫Øt h·ªï', 'Trang s·ª©c v√†ng', 'ƒê·ªì decor sang tr·ªçng'],
                'Virgo': ['ƒê√° ng·ªçc l·ª•c b·∫£o', 'S·ªï tay', 'C√¢y ƒë·ªÉ b√†n'],
                'Libra': ['ƒê√° th·∫°ch anh t√≠m', 'N∆∞·ªõc hoa', 'Tranh ngh·ªá thu·∫≠t'],
                'Scorpio': ['ƒê√° obsidian', 'V√≤ng tay phong thu·ª∑', 'N∆∞·ªõc hoa b√≠ ·∫©n'],
                'Sagittarius': ['ƒê√° ng·ªçc lam', 'Balo du l·ªãch', 'S√°ch kh√°m ph√°'],
                'Capricorn': ['ƒê√° m√£ n√£o', 'ƒê·ªìng h·ªì', 'V·∫≠t ph·∫©m m√†u n√¢u/x√°m'],
                'Aquarius': ['ƒê√° sapphire', 'ƒê·ªì c√¥ng ngh·ªá', 'Ph·ª• ki·ªán ƒë·ªôc l·∫°'],
                'Pisces': ['ƒê√° aquamarine', 'ƒê√®n ng·ªß', 'ƒê·ªì decor bi·ªÉn']
            };
            const shoppingList = shoppingSuggestionsMap[zodiac] || ['V·∫≠t ph·∫©m phong thu·ª∑ h·ª£p m·ªánh', 'ƒê·ªì trang tr√≠ mang l·∫°i may m·∫Øn'];
            let shoppingText = `**G·ª£i √Ω cho ${zodiac}:**\n`;
            shoppingList.forEach(item => { shoppingText += `- ${item}\n`; });
            if (age && age.years < 13) shoppingText += '- ƒê·ªì ch∆°i gi√°o d·ª•c, s√°ch tranh, v·∫≠t ph·∫©m an to√†n cho tr·∫ª nh·ªè\n';
            else if (age && age.years < 20) shoppingText += '- S√°ch ph√°t tri·ªÉn b·∫£n th√¢n, ph·ª• ki·ªán c√° t√≠nh, ƒë·ªì th·ªÉ thao\n';
            else if (age && age.years < 40) shoppingText += '- ƒê·ªì decor vƒÉn ph√≤ng, ƒë·ªìng h·ªì, v·∫≠t ph·∫©m phong thu·ª∑ cho s·ª± nghi·ªáp\n';
            else if (age && age.years < 60) shoppingText += '- ƒê·ªì chƒÉm s√≥c s·ª©c kho·∫ª, c√¢y c·∫£nh, v·∫≠t ph·∫©m th∆∞ gi√£n\n';
            else if (age) shoppingText += '- ƒê·ªì d∆∞·ª°ng sinh, v·∫≠t ph·∫©m an l·∫°c, s√°ch truy·ªÅn c·∫£m h·ª©ng\n';
            document.getElementById('shopping-suggestions').innerHTML = enhanceContent(markdownToHtml(shoppingText));
        }

        // Add new functions for enhanced analysis
        async function processDOB() {
            const dob = document.getElementById('dob').value;
            const resultDiv = document.getElementById('result');
            const submitBtn = document.getElementById('submit');
            const dobError = document.getElementById('dob-error');
            const spinner = document.getElementById('spinner');
            const tryAnotherBtn = document.getElementById('try-another');

            // Reset UI state before processing
            resultDiv.classList.add('hidden');
            resultDiv.classList.remove('fade-in');
            document.getElementById('basic-info').innerHTML = '';
            document.getElementById('personality-traits').innerHTML = '';
            document.getElementById('life-cycle').innerHTML = '';
            document.getElementById('interesting-facts').innerHTML = '';
            tryAnotherBtn.style.display = 'none';
            spinner.style.display = 'none';
            dobError.style.display = 'none';
            // ·∫®n t·∫•t c·∫£ c√°c card v√† n√∫t khi b·∫Øt ƒë·∫ßu
            document.getElementById('basic-info-card').classList.add('hidden');
            document.getElementById('personality-traits-card').classList.add('hidden');
            document.getElementById('life-cycle-card').classList.add('hidden');
            document.getElementById('interesting-facts-card').classList.add('hidden');
            document.getElementById('btn-personality').classList.add('hidden');
            document.getElementById('btn-life-cycle').classList.add('hidden');
            document.getElementById('btn-interesting').classList.add('hidden');
            // ·∫®n progress bar khi b·∫Øt ƒë·∫ßu
            document.getElementById('progress-bar-container').classList.add('hidden');
            document.getElementById('progress-bar').style.width = '0%';
            // ·∫®n c√°c n√∫t ch·ªçn card v√† reset auto open
            document.getElementById('card-buttons').classList.add('hidden');
            autoOpenStopped = false;
            clearAutoOpenTimeouts();

            if (!dob) {
                dobError.textContent = 'Please enter a valid date of birth.';
                dobError.style.display = 'block';
                return;
            }

            // Ki·ªÉm tra ƒë·ªãnh d·∫°ng yyyy-mm-dd
            if (!/^\d{4}-\d{2}-\d{2}$/.test(dob)) {
                dobError.textContent = 'Vui l√≤ng ch·ªçn ng√†y sinh h·ª£p l·ªá (yyyy-mm-dd)';
                dobError.style.display = 'block';
                return;
            }

            console.log('[Step 1] User submitted DOB:', dob);
            submitBtn.disabled = true;
            spinner.style.display = 'flex';
            setTimeout(() => {
                resultDiv.classList.add('fade-in');
                resultDiv.classList.remove('hidden');
                // Hi·ªán card Basic Info ngay l·∫≠p t·ª©c
                document.getElementById('basic-info-card').classList.remove('hidden');
                setTimeout(() => document.getElementById('basic-info-card').classList.add('show'), 10);
                // ·∫®n spinner ngay khi ƒë√£ c√≥ k·∫øt qu·∫£ c∆° b·∫£n
                spinner.style.display = 'none';
                // Chuy·ªÉn hi·ªáu ·ª©ng sang "AI ƒëang ƒë∆∞a ra nh·∫≠n x√©t..." trong 2s r·ªìi ·∫©n
                const aiStatus = document.getElementById('ai-status');
                const aiStatusText = document.getElementById('ai-status-text');
                const aiDots = document.getElementById('ai-dots');
                aiStatusText.textContent = 'AI ƒëang ƒë∆∞a ra nh·∫≠n x√©t...';
                aiDots.style.display = 'none';
                setTimeout(() => { aiStatus.style.display = 'none'; }, 2000);
                // Hi·ªán th√¥ng b√°o v√† c√°c n√∫t ch·ªçn card
                document.getElementById('card-buttons').classList.remove('hidden');
                // T·ª± ƒë·ªông m·ªü t·ª´ng card n·∫øu user kh√¥ng ch·ªçn g√¨
                autoOpenTimeouts.push(setTimeout(() => {
                    if (!autoOpenStopped) document.getElementById('personality-traits-card').classList.remove('hidden');
                    setTimeout(() => document.getElementById('personality-traits-card').classList.add('show'), 10);
                    autoOpenTimeouts.push(setTimeout(() => {
                        if (!autoOpenStopped) document.getElementById('life-cycle-card').classList.remove('hidden');
                        setTimeout(() => document.getElementById('life-cycle-card').classList.add('show'), 10);
                        autoOpenTimeouts.push(setTimeout(() => {
                            if (!autoOpenStopped) document.getElementById('interesting-facts-card').classList.remove('hidden');
                            setTimeout(() => document.getElementById('interesting-facts-card').classList.add('show'), 10);
                        }, 3000));
                    }, 3000));
                }, 3000));
            }, 200);
            tryAnotherBtn.style.display = 'block';
            
            try {
                console.log('[Step 2] Calculating age...');
                const age = calculateAge(dob);
                console.log('[Step 2] Age calculated:', age);

                console.log('[Step 3] Determining zodiac sign...');
                const zodiac = getZodiacSign(dob);
                console.log('[Step 3] Zodiac sign:', zodiac);

                console.log('[Step 4] Determining life stage...');
                const lifeStage = getLifeStage(age.years);
                console.log('[Step 4] Life stage:', lifeStage);

                // T√≠nh to√°n numerology tr∆∞·ªõc khi d√πng
                const numerologyNum = getNumerology(dob);
                const numerologyFact = getNumerologyFact(numerologyNum);

                // Format the results
                const basicInfo = `**Your Age:** ${age.years} years, ${age.months} months, and ${age.days} days\n` +
                                 `**Zodiac Sign:** ${zodiac}\n` +
                                 `**Life Stage:** ${lifeStage}`;

                // Ho√†n thi·ªán n·ªôi dung Personality Traits
                const zodiacTraits = {
                    'Aries': 'NƒÉng ƒë·ªông, nhi·ªát huy·∫øt, th√≠ch th·ª≠ th√°ch, ƒë√¥i khi n√≥ng n·∫£y.',
                    'Taurus': 'Ki√™n ƒë·ªãnh, th·ª±c t·∫ø, y√™u c√°i ƒë·∫πp, ƒë√¥i khi b∆∞·ªõng b·ªânh.',
                    'Gemini': 'Linh ho·∫°t, giao ti·∫øp t·ªët, t√≤ m√≤, ƒë√¥i khi thi·∫øu ki√™n nh·∫´n.',
                    'Cancer': 'T√¨nh c·∫£m, quan t√¢m, nh·∫°y c·∫£m, ƒë√¥i khi d·ªÖ b·ªã t·ªïn th∆∞∆°ng.',
                    'Leo': 'T·ª± tin, s√°ng t·∫°o, h√†o ph√≥ng, ƒë√¥i khi ki√™u ng·∫°o.',
                    'Virgo': 'T·ªâ m·ªâ, chƒÉm ch·ªâ, ph√¢n t√≠ch t·ªët, ƒë√¥i khi c·∫ßu to√†n.',
                    'Libra': 'C√¥ng b·∫±ng, duy√™n d√°ng, y√™u h√≤a b√¨nh, ƒë√¥i khi do d·ª±.',
                    'Scorpio': 'S√¢u s·∫Øc, quy·∫øt ƒëo√°n, b√≠ ·∫©n, ƒë√¥i khi ghen tu√¥ng.',
                    'Sagittarius': 'L·∫°c quan, th√≠ch t·ª± do, ham h·ªçc h·ªèi, ƒë√¥i khi thi·∫øu ki√™n nh·∫´n.',
                    'Capricorn': 'K·ª∑ lu·∫≠t, tr√°ch nhi·ªám, tham v·ªçng, ƒë√¥i khi c·ª©ng nh·∫Øc.',
                    'Aquarius': 'S√°ng t·∫°o, ƒë·ªôc l·∫≠p, nh√¢n vƒÉn, ƒë√¥i khi l·∫≠p d·ªã.',
                    'Pisces': 'Nh·∫°y c·∫£m, gi√†u tr√≠ t∆∞·ªüng t∆∞·ª£ng, v·ªã tha, ƒë√¥i khi m∆° m·ªông.'
                };
                const trait = zodiacTraits[zodiac] || '';
                const personalityTraits =
                    `**Zodiac:** ${zodiac}\n` +
                    `**Key Traits:** ${trait}\n` +
                    `**Numerology:** S·ªë ch·ªß ƒë·∫°o c·ªßa b·∫°n l√† ${numerologyNum} ‚Äì ${numerologyFact}`;

                // Ho√†n thi·ªán n·ªôi dung Life Cycle Analysis
                function getLifeMilestones(age) {
                    if (age < 13) return ['Kh√°m ph√° b·∫£n th√¢n', 'H·ªçc h·ªèi k·ªπ nƒÉng c∆° b·∫£n', 'T·∫°o d·ª±ng n·ªÅn t·∫£ng gia ƒë√¨nh'];
                    if (age < 20) return ['Ph√°t tri·ªÉn c√° t√≠nh', 'T√¨m ki·∫øm ƒëam m√™', 'K·∫øt b·∫°n v√† x√¢y d·ª±ng c√°c m·ªëi quan h·ªá'];
                    if (age < 40) return ['X√¢y d·ª±ng s·ª± nghi·ªáp', 'T√¨m ki·∫øm s·ª± ·ªïn ƒë·ªãnh', 'Ph√°t tri·ªÉn b·∫£n th√¢n'];
                    if (age < 60) return ['·ªîn ƒë·ªãnh t√†i ch√≠nh', 'Chia s·∫ª kinh nghi·ªám', 'ChƒÉm s√≥c s·ª©c kh·ªèe'];
                    return ['T·∫≠n h∆∞·ªüng cu·ªôc s·ªëng', 'G·∫Øn k·∫øt gia ƒë√¨nh', 'Truy·ªÅn c·∫£m h·ª©ng cho th·∫ø h·ªá sau'];
                }
                const milestones = getLifeMilestones(age.years);
                const lifeCycle =
                    `**Current Stage:** ${lifeStage}\n` +
                    `**Major Milestones:**\n- ${milestones.join('\n- ')}`;

                console.log('[Step 5] Generating interesting facts...');
                const daysOld = Math.floor((new Date() - new Date(dob)) / (1000 * 60 * 60 * 24));
                const famous = getFamousBirthdays(dob);
                const event = getHistoricalEvent(dob, 10);
                console.log('[Step 5] Days old:', daysOld);
                console.log('[Step 5] Famous birthdays:', famous);
                console.log('[Step 5] 10th birthday event:', event);

                const interestingFacts = `You are approximately **${daysOld} days old**.\n` +
                    `Famous people born on your date: ${famous}\n` +
                    `On your 10th birthday, this happened: ${event}`;

                // Update the display
                document.getElementById('basic-info').innerHTML = enhanceContent(markdownToHtml(basicInfo));
                document.getElementById('personality-traits').innerHTML = enhanceContent(markdownToHtml(personalityTraits));
                document.getElementById('life-cycle').innerHTML = enhanceContent(markdownToHtml(lifeCycle));
                document.getElementById('interesting-facts').innerHTML = enhanceContent(markdownToHtml(interestingFacts));
                console.log('[Step 6] Display updated.');

                // G·ª£i √Ω v·∫≠t ph·∫©m phong thu·ª∑
                document.getElementById('shopping-suggestions-card').classList.add('hidden');
                document.getElementById('btn-shopping').classList.add('hidden');
                document.getElementById('shopping-suggestions').innerHTML = '';
                document.getElementById('btn-shopping').classList.add('pulse-highlight');
                setTimeout(() => {
                    document.getElementById('btn-shopping').classList.remove('hidden');
                    document.getElementById('btn-shopping').classList.add('pulse-highlight');
                }, 9000);

                // L∆∞u l·∫°i zodiac v√† age ƒë·ªÉ d√πng khi click
                window.lastZodiac = zodiac;
                window.lastAge = age;

            } catch (error) {
                console.error('[Error] Processing DOB:', error);
                spinner.style.display = 'none';
                alert('Error processing your birth date. Please try again.');
            } finally {
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                console.log('[Step 7] Processing complete.');
            }
        }

        // Update event listener
        document.getElementById('submit').addEventListener('click', processDOB);

        // Set max date for dob input to today (GMT+7)
        function getTodayGmt7() {
            const now = new Date();
            const gmt7Offset = 7 * 60 * 60 * 1000;
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const gmt7 = new Date(utc + gmt7Offset);
            return gmt7.toISOString().slice(0, 10);
        }
        document.getElementById('dob').max = getTodayGmt7();

        // Add logs to helpers
        function calculateAge(birthDate) {
            console.log('[Helper] calculateAge called with:', birthDate);
            const today = new Date();
            const birth = new Date(birthDate);
            let years = today.getFullYear() - birth.getFullYear();
            let months = today.getMonth() - birth.getMonth();
            let days = today.getDate() - birth.getDate();

            if (days < 0) {
                months--;
                days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }
            console.log('[Helper] calculateAge result:', { years, months, days });
            return { years, months, days };
        }
        function getZodiacSign(birthDate) {
            console.log('[Helper] getZodiacSign called with:', birthDate);
            const date = parseInt(birthDate.split('-')[2]);
            const month = parseInt(birthDate.split('-')[1]);
            const signs = [
                { name: 'Capricorn', dates: [22, 19] },
                { name: 'Aquarius', dates: [20, 18] },
                { name: 'Pisces', dates: [19, 20] },
                { name: 'Aries', dates: [21, 19] },
                { name: 'Taurus', dates: [20, 20] },
                { name: 'Gemini', dates: [21, 20] },
                { name: 'Cancer', dates: [21, 22] },
                { name: 'Leo', dates: [23, 22] },
                { name: 'Virgo', dates: [23, 22] },
                { name: 'Libra', dates: [23, 22] },
                { name: 'Scorpio', dates: [23, 21] },
                { name: 'Sagittarius', dates: [22, 21] }
            ];
            const currentSign = signs[month - 1];
            const result = date >= currentSign.dates[0] || date <= currentSign.dates[1] ? currentSign.name : signs[month % 12].name;
            console.log('[Helper] getZodiacSign result:', result);
            return result;
        }
        function getLifeStage(age) {
            console.log('[Helper] getLifeStage called with:', age);
            let stage = '';
            if (age < 13) stage = 'Childhood';
            else if (age < 20) stage = 'Adolescence';
            else if (age < 40) stage = 'Young Adult';
            else if (age < 60) stage = 'Middle Age';
            else stage = 'Senior';
            console.log('[Helper] getLifeStage result:', stage);
            return stage;
        }
        function getFamousBirthdays(dob) {
            console.log('[Helper] getFamousBirthdays called with:', dob);
            const monthDay = dob.slice(5);
            const famous = {
                '01-01': 'Paul Revere, Verne Troyer',
                '07-20': 'Alexander the Great, Gisele B√ºndchen',
                '12-25': 'Isaac Newton, Justin Trudeau',
                // ... add more as needed
            };
            const result = famous[monthDay] || 'No major celebrities found (try 01-01, 07-20, 12-25)';
            console.log('[Helper] getFamousBirthdays result:', result);
            return result;
        }
        function getHistoricalEvent(dob, yearsAfter) {
            console.log('[Helper] getHistoricalEvent called with:', dob, yearsAfter);
            const year = parseInt(dob.slice(0, 4)) + yearsAfter;
            const events = {
                2000: 'Y2K bug was a big topic!',
                2010: 'Instagram was launched.',
                2020: 'Global COVID-19 pandemic.',
                // ... add more as needed
            };
            const result = events[year] || 'No major event found for that year.';
            console.log('[Helper] getHistoricalEvent result:', result);
            return result;
        }
        function getNumerology(dob) {
            console.log('[Helper] getNumerology called with:', dob);
            const digits = dob.replace(/-/g, '').split('').map(Number);
            let sum = digits.reduce((a, b) => a + b, 0);
            while (sum > 9) sum = sum.toString().split('').reduce((a, b) => a + +b, 0);
            console.log('[Helper] getNumerology result:', sum);
            return sum;
        }
        function getNumerologyFact(num) {
            console.log('[Helper] getNumerologyFact called with:', num);
            const facts = {
                1: 'Leadership and independence.',
                2: 'Harmony and partnership.',
                3: 'Creativity and joy.',
                4: 'Stability and discipline.',
                5: 'Adventure and freedom.',
                6: 'Care and responsibility.',
                7: 'Intellect and introspection.',
                8: 'Power and ambition.',
                9: 'Compassion and idealism.'
            };
            const result = facts[num] || 'A unique number!';
            console.log('[Helper] getNumerologyFact result:', result);
            return result;
        }

        // Th√™m h√†m toggleCard ƒë·ªÉ m·ªü/ƒë√≥ng t·ª´ng card
        function toggleCard(cardId) {
            const card = document.getElementById(cardId);
            if (card.classList.contains('hidden')) {
                card.classList.remove('hidden');
                setTimeout(() => card.classList.add('show'), 10);
            } else {
                card.classList.remove('show');
                setTimeout(() => card.classList.add('hidden'), 300);
            }
        }

        // Try another date button logic
        document.getElementById('try-another').onclick = function() {
            const resultDiv = document.getElementById('result');
            resultDiv.classList.add('hidden');
            resultDiv.classList.remove('fade-in');
            document.getElementById('dob').value = '';
            document.getElementById('dob-error').style.display = 'none';
            document.getElementById('basic-info').innerHTML = '';
            document.getElementById('personality-traits').innerHTML = '';
            document.getElementById('life-cycle').innerHTML = '';
            document.getElementById('interesting-facts').innerHTML = '';
            document.getElementById('spinner').style.display = 'none';
            this.style.display = 'none';
            document.getElementById('basic-info-card').classList.add('hidden');
            document.getElementById('personality-traits-card').classList.add('hidden');
            document.getElementById('life-cycle-card').classList.add('hidden');
            document.getElementById('interesting-facts-card').classList.add('hidden');
            document.getElementById('btn-personality').classList.add('hidden');
            document.getElementById('btn-life-cycle').classList.add('hidden');
            document.getElementById('btn-interesting').classList.add('hidden');
            // ·∫®n progress bar khi b·∫Øt ƒë·∫ßu
            document.getElementById('progress-bar-container').classList.add('hidden');
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('card-buttons').classList.add('hidden');
            autoOpenStopped = false;
            clearAutoOpenTimeouts();
            document.getElementById('shopping-suggestions-card').classList.add('hidden');
            document.getElementById('btn-shopping').classList.add('hidden');
            document.getElementById('shopping-suggestions').innerHTML = '';
            document.getElementById('btn-shopping').classList.add('pulse-highlight');
        };
    </script>
</body>
</html>